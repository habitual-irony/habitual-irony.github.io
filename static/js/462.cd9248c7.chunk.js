"use strict";(self.webpackChunkhabitual_irony=self.webpackChunkhabitual_irony||[]).push([[462],{462:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var l=n(65043),r=n(7898),i=n(11651);const o=(0,r.UM)({id:"upload",button:{name:"Upload",toolbar:!0,contextMenu:!1,icon:r.jz.upload}}),a=[(0,r.UM)({id:"view",requiresSelection:!0,fileFilter:e=>!e.isDir,button:{name:"View",toolbar:!1,contextMenu:!0,icon:r.jz.file}}),o];var d=n(96446),s=n(70579);const c=l.memo((e=>{const[t,n]=(0,l.useState)(!1),o=(0,l.useRef)(null),c=e.chonkyMap,u=()=>({baseFileMap:c.fileMap,rootFolderId:c.rootFolderId}),{fileMap:f,currentFolderId:h,setCurrentFolderId:p,deleteFiles:m,moveFiles:F,createFolder:I,createFile:b}=(()=>{const{baseFileMap:e,rootFolderId:t}=(0,l.useMemo)(u,[]),[n,r]=(0,l.useState)(e),[i,o]=(0,l.useState)(t),a=(0,l.useCallback)((()=>{r(e),o(t)}),[e,t]),d=(0,l.useRef)(i);(0,l.useEffect)((()=>{d.current=i}),[i]);const s=(0,l.useCallback)((e=>{r((t=>{const n={...t};return e.forEach((e=>{if(delete n[e.id],e.parentId){const t=n[e.parentId],l=t.childrenIds.filter((t=>t!==e.id));n[e.parentId]={...t,childrenIds:l,childrenCount:l.length}}})),n}))}),[]),c=(0,l.useCallback)(((e,t,n)=>{r((l=>{const r={...l},i=new Set(e.map((e=>e.id))),o=t.childrenIds.filter((e=>!i.has(e)));r[t.id]={...t,childrenIds:o,childrenCount:o.length};const a=[...n.childrenIds,...e.map((e=>e.id))];return r[n.id]={...n,childrenIds:a,childrenCount:a.length},e.forEach((e=>{r[e.id]={...e,parentId:n.id}})),r}))}),[]),f=(0,l.useRef)(0),h=(0,l.useCallback)((e=>{r((t=>{const n={...t},l="new-folder-".concat(f.current++);n[l]={id:l,name:e,isDir:!0,modDate:new Date,parentId:d.current,childrenIds:[],childrenCount:0};const r=n[d.current];return n[d.current]={...r,childrenIds:[...r.childrenIds,l]},n}))}),[]),p=(0,l.useCallback)((e=>{r((t=>{const n={...t},l="new-folder-".concat(f.current++);n[l]={id:l,name:e,modDate:new Date,parentId:d.current,childrenIds:[],childrenCount:0};const r=n[d.current];return n[d.current]={...r,childrenIds:[...r.childrenIds,l]},n}))}),[]);return{fileMap:n,currentFolderId:i,setCurrentFolderId:o,resetFileMap:a,deleteFiles:s,moveFiles:c,createFolder:h,createFile:p}})();(0,r.B$)({iconComponent:i.R});const C=((e,t)=>(0,l.useMemo)((()=>e[t].childrenIds.map((t=>e[t]))),[t,e]))(f,h),k=((e,t)=>(0,l.useMemo)((()=>{const n=e[t],l=[n];let r=n.parentId;for(;r;){const t=e[r];if(!t)break;l.unshift(t),r=t.parentId}return l}),[t,e]))(f,h),M=((e,t,n,i,o,a,d)=>(0,l.useCallback)((l=>{if(l.id===r.YQ.OpenFiles.id){const{targetFile:n,files:i}=l.payload,o=n||i[0];if(o&&r.FP.isDirectory(o))return void t(o.id);if(n.name.endsWith(".md")){let t=l.state.selectedFiles.map((e=>e.name)),n=e.map((e=>e.name)).join("/"),r="".concat(n,"/").concat(t);localStorage.setItem("FILE_PATH",JSON.stringify({filePath:r})),window.open("/react-project/tui-editor","_blank")}}else if(l.id===r.YQ.DeleteFiles.id)n(l.state.selectedFilesForAction);else if(l.id===r.YQ.MoveFiles.id)i(l.payload.files,l.payload.source,l.payload.destination);else if(l.id===r.YQ.CreateFolder.id){const e=prompt("Provide the name for your new folder:");e&&o(e)}else if(l.id===r.YQ.ToggleDarkMode.id)a();else if("view"===l.id){let t=l.state.selectedFiles.map((e=>e.name)),n=e.map((e=>e.name)).join("/");for(let e of t)console.log("".concat(n,"/").concat(e))}else"upload"===l.id&&d.current.click();console.log(l)}),[o,n,i,t,a]))(k,p,m,F,I,(()=>{n(!t)}),o),y=(0,l.useMemo)((()=>[...a,r.YQ.CreateFolder,r.YQ.DeleteFiles,r.YQ.ToggleDarkMode]),[]),g=(0,l.useCallback)((e=>e.thumbnailUrl?"https://chonky.io".concat(e.thumbnailUrl):null),[]);return(0,s.jsxs)(d.A,{sx:{m:2},children:[(0,s.jsx)("input",{type:"file",ref:o,accept:".json,.md",style:{display:"none"},multiple:!0,onChange:e=>(async e=>{let t=e.target.files;for(let n of t)void 0!==n&&b(n.name)})(e)}),(0,s.jsx)("div",{style:{height:400},children:(0,s.jsx)(r.I0,{files:C,folderChain:k,fileActions:y,onFileAction:M,thumbnailGenerator:g,darkMode:t,...e})})]})})),u=()=>{const[e,t]=(0,l.useState)(void 0);return(0,l.useEffect)((()=>{(async()=>{let e=await(async e=>{})();if(void 0===e)return;let n=JSON.parse(e);t(n)})()}),[]),(0,s.jsx)("div",{children:e&&(0,s.jsx)(c,{chonkyMap:e})})}}}]);
//# sourceMappingURL=462.cd9248c7.chunk.js.map