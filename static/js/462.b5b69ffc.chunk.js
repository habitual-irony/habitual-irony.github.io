"use strict";(self.webpackChunkhabitual_irony=self.webpackChunkhabitual_irony||[]).push([[462],{462:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var r=n(65043),o=n(7898),l=n(11651);const i=(0,o.UM)({id:"upload",button:{name:"Upload",toolbar:!0,contextMenu:!1,icon:o.jz.upload}}),a=[(0,o.UM)({id:"view",requiresSelection:!0,fileFilter:e=>!e.isDir,button:{name:"View",toolbar:!1,contextMenu:!0,icon:o.jz.file}}),i];var c=n(96446),d=n(70579);const s=r.memo((e=>{const[t,n]=(0,r.useState)(!1),i=(0,r.useRef)(null),s=e.chonkyMap,u=()=>({baseFileMap:s.fileMap,rootFolderId:s.rootFolderId}),{fileMap:p,currentFolderId:f,setCurrentFolderId:h,deleteFiles:m,moveFiles:F,createFolder:I,createFile:b}=(()=>{const{baseFileMap:e,rootFolderId:t}=(0,r.useMemo)(u,[]),[n,o]=(0,r.useState)(e),[l,i]=(0,r.useState)(t),a=(0,r.useCallback)((()=>{o(e),i(t)}),[e,t]),c=(0,r.useRef)(l);(0,r.useEffect)((()=>{c.current=l}),[l]);const d=(0,r.useCallback)((e=>{o((t=>{const n={...t};return e.forEach((e=>{if(delete n[e.id],e.parentId){const t=n[e.parentId],r=t.childrenIds.filter((t=>t!==e.id));n[e.parentId]={...t,childrenIds:r,childrenCount:r.length}}})),n}))}),[]),s=(0,r.useCallback)(((e,t,n)=>{o((r=>{const o={...r},l=new Set(e.map((e=>e.id))),i=t.childrenIds.filter((e=>!l.has(e)));o[t.id]={...t,childrenIds:i,childrenCount:i.length};const a=[...n.childrenIds,...e.map((e=>e.id))];return o[n.id]={...n,childrenIds:a,childrenCount:a.length},e.forEach((e=>{o[e.id]={...e,parentId:n.id}})),o}))}),[]),p=(0,r.useRef)(0),f=(0,r.useCallback)((e=>{o((t=>{const n={...t},r="new-folder-".concat(p.current++);n[r]={id:r,name:e,isDir:!0,modDate:new Date,parentId:c.current,childrenIds:[],childrenCount:0};const o=n[c.current];return n[c.current]={...o,childrenIds:[...o.childrenIds,r]},n}))}),[]),h=(0,r.useCallback)((e=>{o((t=>{const n={...t},r="new-folder-".concat(p.current++);n[r]={id:r,name:e,modDate:new Date,parentId:c.current,childrenIds:[],childrenCount:0};const o=n[c.current];return n[c.current]={...o,childrenIds:[...o.childrenIds,r]},n}))}),[]);return{fileMap:n,currentFolderId:l,setCurrentFolderId:i,resetFileMap:a,deleteFiles:d,moveFiles:s,createFolder:f,createFile:h}})();(0,o.B$)({iconComponent:l.R});const y=((e,t)=>(0,r.useMemo)((()=>e[t].childrenIds.map((t=>e[t]))),[t,e]))(p,f),C=((e,t)=>(0,r.useMemo)((()=>{const n=e[t],r=[n];let o=n.parentId;for(;o;){const t=e[o];if(!t)break;r.unshift(t),o=t.parentId}return r}),[t,e]))(p,f),k=((e,t,n,l,i,a,c)=>(0,r.useCallback)((r=>{if(r.id===o.YQ.OpenFiles.id){const{targetFile:n,files:l}=r.payload,i=n||l[0];if(i&&o.FP.isDirectory(i))return void t(i.id);if(n.name.endsWith(".md")){let t=r.state.selectedFiles.map((e=>e.name)),n=e.map((e=>e.name)).join("/"),o="".concat(n,"/").concat(t);localStorage.setItem("FILE_PATH",JSON.stringify({filePath:o})),window.open("/react-project/tui-editor","_blank")}}else if(r.id===o.YQ.DeleteFiles.id)n(r.state.selectedFilesForAction);else if(r.id===o.YQ.MoveFiles.id)l(r.payload.files,r.payload.source,r.payload.destination);else if(r.id===o.YQ.CreateFolder.id){const e=prompt("Provide the name for your new folder:");e&&i(e)}else if(r.id===o.YQ.ToggleDarkMode.id)a();else if("view"===r.id){let t=r.state.selectedFiles.map((e=>e.name)),n=e.map((e=>e.name)).join("/");for(let e of t)console.log("".concat(n,"/").concat(e))}else"upload"===r.id&&c.current.click();console.log(r)}),[i,n,l,t,a]))(C,h,m,F,I,(()=>{n(!t)}),i),g=(0,r.useMemo)((()=>[...a,o.YQ.CreateFolder,o.YQ.DeleteFiles,o.YQ.ToggleDarkMode]),[]),M=(0,r.useCallback)((e=>e.thumbnailUrl?"https://chonky.io".concat(e.thumbnailUrl):null),[]);return(0,d.jsxs)(c.A,{sx:{m:2},children:[(0,d.jsx)("input",{type:"file",ref:i,accept:".json,.md",style:{display:"none"},multiple:!0,onChange:e=>(async e=>{let t=e.target.files;for(let n of t)void 0!==n&&b(n.name)})(e)}),(0,d.jsx)("div",{style:{height:400},children:(0,d.jsx)(o.I0,{files:y,folderChain:C,fileActions:g,onFileAction:k,thumbnailGenerator:M,darkMode:t,...e})})]})}));var u=n(37198);const p="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".replaceAll("X",""),f="test_repo",h=()=>{const[e,t]=(0,r.useState)(void 0),n=async()=>{let e=await(async e=>{try{const t=new u.E({auth:p}),n=await t.request("GET /repos/habitual-irony/".concat(f,"/contents/").concat(e),{repo:"".concat(f),path:"".concat(e),encoding:"utf-8",decoding:"utf-8"});return decodeURIComponent(escape(window.atob(n.data.content)))}catch(t){return}})("actions/config/chonky_map.json");if(void 0===e)return;let n=JSON.parse(e);t(n)};return(0,r.useEffect)((()=>{n()}),[]),(0,d.jsx)("div",{children:e&&(0,d.jsx)(s,{chonkyMap:e})})}}}]);
//# sourceMappingURL=462.b5b69ffc.chunk.js.map